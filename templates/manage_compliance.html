{% extends "base.html" %}

{% block title %}Compliance Settings - {{ token.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('issuer.dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('issuer.manage_token', token_id=token.id) }}">Manage {{ token.name }}</a></li>
                    <li class="breadcrumb-item active">Compliance</li>
                </ol>
            </nav>
            
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">
                            <i class="fas fa-shield-alt me-2"></i>
                            Compliance Settings - {{ token.name }}
                        </h3>
                        <a href="{{ url_for('issuer.manage_token', token_id=token.id) }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Management
                        </a>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- Claim Topics -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-tags me-2"></i>Claim Topics
                            </h5>
                            <p class="text-muted">These are the types of claims that investors must have to be compliant.</p>
                            
                            <div class="card">
                                <div class="card-body">
                                    {% if compliance_data.claim_topics %}
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Topic Name</th>
                                                        <th>Description</th>
                                                        <th>Required</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for topic in compliance_data.claim_topics %}
                                                    <tr>
                                                        <td><span class="badge bg-primary">{{ topic }}</span></td>
                                                        <td>
                                                            {% if topic == 'KYC' %}
                                                                Know Your Customer verification
                                                            {% elif topic == 'AML' %}
                                                                Anti-Money Laundering check
                                                            {% elif topic == 'Accredited' %}
                                                                Accredited investor status
                                                            {% else %}
                                                                {{ topic }} verification
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <span class="badge bg-success">Required</span>
                                                        </td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-danger">
                                                                <i class="fas fa-trash me-1"></i>Remove
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-tags fa-2x text-muted mb-3"></i>
                                            <p class="text-muted">No claim topics configured</p>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="mt-3">
                                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClaimTopicModal">
                                            <i class="fas fa-plus me-2"></i>Add Claim Topic
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trusted Issuers -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-user-check me-2"></i>Trusted Issuers
                            </h5>
                            <p class="text-muted">These addresses can issue claims for investors.</p>
                            
                            <div class="card">
                                <div class="card-body">
                                    {% if compliance_data.trusted_issuers %}
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Issuer Address</th>
                                                        <th>Type</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for issuer in compliance_data.trusted_issuers %}
                                                    <tr>
                                                        <td><span class="wallet-address">{{ issuer }}</span></td>
                                                        <td><span class="badge bg-info">Trusted Issuer</span></td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-danger">
                                                                <i class="fas fa-trash me-1"></i>Remove
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-user-check fa-2x text-muted mb-3"></i>
                                            <p class="text-muted">No trusted issuers configured</p>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="mt-3">
                                        <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#addTrustedIssuerModal">
                                            <i class="fas fa-plus me-2"></i>Add Trusted Issuer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compliance Modules -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-puzzle-piece me-2"></i>Compliance Modules
                            </h5>
                            <p class="text-muted">Active compliance modules that enforce transfer rules.</p>
                            
                            <div class="card">
                                <div class="card-body">
                                    {% if compliance_data.compliance_modules %}
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Module Name</th>
                                                        <th>Description</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for module in compliance_data.compliance_modules %}
                                                    <tr>
                                                        <td><span class="badge bg-success">{{ module }}</span></td>
                                                        <td>Modular compliance with configurable rules</td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-primary">
                                                                <i class="fas fa-cog me-1"></i>Configure
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-puzzle-piece fa-2x text-muted mb-3"></i>
                                            <p class="text-muted">No compliance modules active</p>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="mt-3">
                                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addComplianceModuleModal">
                                            <i class="fas fa-plus me-2"></i>Add Compliance Module
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Transfer Restrictions -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-ban me-2"></i>Transfer Restrictions
                            </h5>
                            <p class="text-muted">Current transfer restrictions and compliance rules.</p>
                            
                            <div class="card">
                                <div class="card-body">
                                    {% if compliance_data.transfer_restrictions %}
                                        <div class="list-group">
                                            {% for restriction in compliance_data.transfer_restrictions %}
                                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                                <div>
                                                    <i class="fas fa-shield-alt text-warning me-2"></i>
                                                    {{ restriction }}
                                                </div>
                                                <span class="badge bg-warning">Active</span>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <div class="text-center py-4">
                                            <i class="fas fa-ban fa-2x text-muted mb-3"></i>
                                            <p class="text-muted">No transfer restrictions configured</p>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="mt-3">
                                        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#addRestrictionModal">
                                            <i class="fas fa-plus me-2"></i>Add Restriction
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Claim Topic Modal -->
<div class="modal fade" id="addClaimTopicModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Claim Topic</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="claimTopic" class="form-label">Claim Topic</label>
                        <select class="form-select" id="claimTopic">
                            <option value="1">KYC (Know Your Customer) - Topic 1</option>
                            <option value="2">AML (Anti-Money Laundering) - Topic 2</option>
                            <option value="3">Accredited Investor - Topic 3</option>
                            <option value="4">EU Nationality Confirmed - Topic 4</option>
                            <option value="5">US Nationality Confirmed - Topic 5</option>
                            <option value="6">Blacklist - Topic 6</option>
                            <option value="7">Residency - Topic 7</option>
                            <option value="8">Compliance Status - Topic 8</option>
                            <option value="9">Restricted Status - Topic 9</option>
                            <option value="10">Whitelisted Status - Topic 10</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="topicDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="topicDescription" rows="3" readonly></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Add Topic</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Trusted Issuer Modal -->
<div class="modal fade" id="addTrustedIssuerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Trusted Issuer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="issuerAddress" class="form-label">Issuer Wallet Address</label>
                        <input type="text" class="form-control" id="issuerAddress" placeholder="0x...">
                        <div class="form-text">Enter the Ethereum address of the trusted issuer</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-info">Add Issuer</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Compliance Module Modal -->
<div class="modal fade" id="addComplianceModuleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Compliance Module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="complianceModule" class="form-label">Module Type</label>
                        <select class="form-select" id="complianceModule">
                            <option value="ModularCompliance">Modular Compliance</option>
                            <option value="ConditionalTransfer">Conditional Transfer</option>
                            <option value="MaxBalance">Maximum Balance</option>
                            <option value="TransferFrequency">Transfer Frequency</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success">Add Module</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Restriction Modal -->
<div class="modal fade" id="addRestrictionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Transfer Restriction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="restrictionType" class="form-label">Restriction Type</label>
                        <select class="form-select" id="restrictionType">
                            <option value="KYC_Required">KYC Required</option>
                            <option value="No_Blacklisted">No Blacklisted Addresses</option>
                            <option value="Max_Transfer">Maximum Transfer Amount</option>
                            <option value="Time_Lock">Time Lock</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="restrictionValue" class="form-label">Value (if applicable)</label>
                        <input type="text" class="form-control" id="restrictionValue" placeholder="Enter value...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning">Add Restriction</button>
            </div>
        </div>
    </div>
</div>
{% endblock %} 